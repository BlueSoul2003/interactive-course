<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Advice Expert | English Mastery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Core Theme */
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --input-bg: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);

            /* Lesson Specific Accent (Mint Green) */
            --accent-primary: #10b981;
            --accent-glow: rgba(16, 185, 129, 0.4);
            --gradient-main: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --correct-color: #34d399;
            --wrong-color: #f87171;

            --font-main: 'Outfit', sans-serif;
            --font-serif: 'Playfair Display', serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo span {
            color: var(--accent-primary);
        }

        .back-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-link:hover {
            color: var(--accent-primary);
        }

        /* --- Layout --- */
        main {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
            width: 100%;
            flex-grow: 1;
        }

        h1 {
            font-family: var(--font-serif);
            font-size: 3rem;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(to right, #fff, #a7f3d0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p.subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        /* --- Navigation Tabs --- */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-family: var(--font-main);
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--gradient-main);
            color: white;
            border-color: transparent;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        /* --- Content Sections --- */
        .lesson-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .lesson-section.active {
            display: block;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-main);
        }

        .card h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-primary);
            font-family: var(--font-serif);
        }

        .card-desc {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1rem;
        }

        /* --- PROGRESS BAR --- */
        .progress-container {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-main);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* --- PART 1: Grammar Quiz --- */
        .quiz-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 3px solid var(--border-color);
            transition: 0.3s;
        }

        .quiz-item.correct {
            border-left-color: var(--correct-color);
            background: rgba(52, 211, 153, 0.1);
        }

        .quiz-item.wrong {
            border-left-color: var(--wrong-color);
            background: rgba(248, 113, 113, 0.1);
        }

        .quiz-question {
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .quiz-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .option-btn {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--font-main);
            transition: 0.2s;
        }

        .option-btn:hover {
            background: #475569;
        }

        .option-btn.selected {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* --- PART 2: Tone Match --- */
        .tone-wrapper {
            display: grid;
            gap: 20px;
        }

        .tone-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .rude-box {
            background: rgba(248, 113, 113, 0.1);
            color: #fca5a5;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            width: 40%;
            text-align: center;
        }

        .polite-select {
            width: 50%;
            padding: 12px;
            background: var(--input-bg);
            color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            outline: none;
        }

        /* --- PART 3: Email Puzzle --- */
        .email-container {
            background: #fff;
            color: #334155;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .email-header {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .email-badge {
            background: #10b981;
            color: white;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .puzzle-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .row-label {
            width: 80px;
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 700;
            text-align: right;
        }

        .puzzle-select {
            flex: 1;
            padding: 12px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background: #f8fafc;
            color: #334155;
            font-family: inherit;
            cursor: pointer;
            font-weight: 600;
        }

        .puzzle-select:focus {
            border-color: #10b981;
            outline: none;
            background: white;
        }

        /* --- PART 4: Generator --- */
        .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .problem-card {
            background: var(--input-bg);
            border: 2px solid transparent;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .problem-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .problem-card.active {
            border-color: var(--accent-primary);
            background: rgba(16, 185, 129, 0.1);
        }

        .problem-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 10px;
        }

        .problem-title {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .scaffold-form {
            background: rgba(0, 0, 0, 0.2);
            padding: 30px;
            border-radius: 15px;
            border-top: 4px solid var(--accent-primary);
            display: none;
            animation: fadeIn 0.5s;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: var(--accent-primary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: white;
            border-radius: 8px;
            font-family: var(--font-main);
        }

        .hint-pill {
            display: inline-block;
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 5px;
            font-family: monospace;
        }

        .generated-letter {
            background: #fff;
            color: #1e293b;
            padding: 40px;
            border-radius: 2px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            margin-top: 30px;
            display: none;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2);
            transform: rotate(-1deg);
        }

        /* --- Buttons & Controls --- */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn-action {
            background: var(--gradient-main);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-action:disabled {
            background: #475569;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-nav {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
        }

        .btn-nav:hover:not(:disabled) {
            color: white;
            border-color: white;
        }

        .btn-nav:disabled {
            opacity: 0.3;
        }

        .feedback-msg {
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
            min-height: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .tabs {
                gap: 10px;
            }

            .tone-card {
                flex-direction: column;
                text-align: center;
            }

            .rude-box,
            .polite-select {
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="index.html" class="logo">
            <span>‚úâÔ∏è</span> English Mastery
        </a>
        <a href="index.html" class="back-link">
            &larr; Back to Home
        </a>
    </header>

    <main>
        <h1>The Advice Expert</h1>
        <p class="subtitle">Mastering Informal Letters & Tone</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="showSection(1)">1. Grammar Lab</button>
            <button class="tab-btn" onclick="showSection(2)">2. Empathy Meter</button>
            <button class="tab-btn" onclick="showSection(3)">3. Email Puzzle</button>
            <button class="tab-btn" onclick="showSection(4)">4. Dr. Advice</button>
        </div>

        <!-- SECTION 1: GRAMMAR -->
        <div id="section-1" class="lesson-section active">
            <div class="card">
                <h2>Grammar Lab: Modal Verbs</h2>
                <div class="card-desc">Rule: <b>Modal Verb</b> (Should, Can, Must) + <b>Base Verb</b> (Original Form).
                </div>

                <div
                    style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.9rem; color:var(--text-secondary)">
                    <span>Set <span id="g-level">1</span> / 5</span>
                    <span id="g-score">Progress: 0%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="g-progress"></div>
                </div>

                <div id="grammar-container"></div>

                <div class="controls">
                    <button class="btn-nav" id="g-prev-btn" onclick="changeGrammarSet(-1)" disabled>&larr; Prev</button>
                    <button class="btn-action" id="g-check-btn" onclick="checkGrammar()">Check Answers</button>
                    <button class="btn-action" id="g-next-btn" onclick="changeGrammarSet(1)" style="display:none;">Next
                        Set &rarr;</button>
                </div>
                <div id="g-feedback" class="feedback-msg"></div>
            </div>
        </div>

        <!-- SECTION 2: TONE -->
        <div id="section-2" class="lesson-section">
            <div class="card">
                <h2>The Empathy Meter</h2>
                <div class="card-desc">Transform "Rude Commands" into "Polite Advice". Build your EQ.</div>

                <div class="tone-wrapper" id="tone-container"></div>

                <div class="controls">
                    <button class="btn-nav" id="t-prev-btn" onclick="changeToneSet(-1)" disabled>&larr; Prev</button>
                    <div style="color:var(--text-secondary)">Level <span id="t-level">1</span>/3</div>
                    <button class="btn-action" id="t-check-btn" onclick="checkTone()">Check Tone</button>
                    <button class="btn-action" id="t-next-btn" onclick="changeToneSet(1)" style="display:none;">Next
                        Level &rarr;</button>
                </div>
                <div id="t-feedback" class="feedback-msg"></div>
            </div>
        </div>

        <!-- SECTION 3: PUZZLE -->
        <div id="section-3" class="lesson-section">
            <div class="card">
                <h2>Email Logic Puzzle</h2>
                <div class="card-desc">Reassemble the scrambled emails into a logical flow using the dropdowns.</div>

                <div class="email-container">
                    <div class="email-header">
                        <span class="email-badge">New Message</span>
                        <button class="btn-nav" style="font-size:0.8rem; padding:5px 10px;"
                            onclick="toggleHints()">Show/Hide Chinese</button>
                    </div>

                    <h3 id="puzzle-title" style="margin-bottom:20px; color:#334155; font-size:1.2rem;">Scenario 1</h3>
                    <div id="puzzle-wrapper"></div>
                </div>

                <div class="controls">
                    <button class="btn-nav" id="p-prev-btn" onclick="changePuzzleSet(-1)" disabled>&larr; Prev</button>
                    <button class="btn-action" id="p-check-btn" onclick="checkPuzzle()">Check Logic</button>
                    <button class="btn-action" id="p-next-btn" onclick="changePuzzleSet(1)" style="display:none;">Next
                        Scenario &rarr;</button>
                </div>
                <div id="p-feedback" class="feedback-msg"></div>
            </div>
        </div>

        <!-- SECTION 4: GENERATOR -->
        <div id="section-4" class="lesson-section">
            <div class="card">
                <h2>Dr. Advice Generator</h2>
                <div class="card-desc">Select a patient's problem and prescribe the best advice.</div>

                <div class="problem-grid">
                    <div class="problem-card" onclick="selectProblem(0, this)">
                        <span class="problem-icon">üí∏</span>
                        <div class="problem-title">No Money</div>
                    </div>
                    <div class="problem-card" onclick="selectProblem(1, this)">
                        <span class="problem-icon">üò¥</span>
                        <div class="problem-title">Always Sleepy</div>
                    </div>
                    <div class="problem-card" onclick="selectProblem(2, this)">
                        <span class="problem-icon">ü§¨</span>
                        <div class="problem-title">Bullying</div>
                    </div>
                    <div class="problem-card" onclick="selectProblem(3, this)">
                        <span class="problem-icon">üéÆ</span>
                        <div class="problem-title">Game Addict</div>
                    </div>
                </div>

                <div id="scaffold" class="scaffold-form">
                    <div class="form-group">
                        <label class="form-label">1. Show Empathy (Sympathy)</label>
                        <input type="text" id="inp-sympathy" class="form-input"
                            value="I am sorry to hear about your problem.">
                    </div>

                    <div class="form-group">
                        <label class="form-label">2. Advice 1 (Use "Should")</label>
                        <div id="hint-1" class="hint-pill">Hint will appear here</div>
                        <input type="text" id="inp-adv1" class="form-input" placeholder="e.g. I think you should...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">3. Advice 2 (Use "Why don't you")</label>
                        <div id="hint-2" class="hint-pill">Hint will appear here</div>
                        <input type="text" id="inp-adv2" class="form-input" placeholder="e.g. Why don't you...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">4. Closing (Encouragement)</label>
                        <input type="text" id="inp-close" class="form-input"
                            value="Don't give up. I know you can do it!">
                    </div>

                    <button class="btn-action" style="width:100%" onclick="generateLetter()">üöÄ Generate Full
                        Letter</button>

                    <div id="final-letter" class="generated-letter"></div>
                </div>

            </div>
        </div>

    </main>

    <script>
        // --- NAVIGATION ---
        function showSection(num) {
            document.querySelectorAll('.lesson-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`section-${num}`).classList.add('active');
            document.querySelectorAll('.tab-btn')[num - 1].classList.add('active');
        }

        // --- PART 1: GRAMMAR DATA ---
        const grammarSets = [
            { title: "Set 1: Should", qs: [{ q: "You should ______ harder.", opts: ["study", "to study", "studying"], a: "study" }, { q: "He should ______ more water.", opts: ["drink", "drinks", "drinking"], a: "drink" }, { q: "We should ______ early.", opts: ["sleep", "sleeping", "to sleep"], a: "sleep" }, { q: "You should ______ parents.", opts: ["helped", "help", "helping"], a: "help" }, { q: "They should ______ kindness.", opts: ["show", "to show", "showing"], a: "show" }] },
            { title: "Set 2: Could", qs: [{ q: "You could ______ to music.", opts: ["listening", "listen", "to listen"], a: "listen" }, { q: "She could ______ a diary.", opts: ["write", "writes", "wrote"], a: "write" }, { q: "You could ______ a walk.", opts: ["go", "going", "goes"], a: "go" }, { q: "We could ______ a movie.", opts: ["watch", "watching", "watched"], a: "watch" }, { q: "You could ______ money.", opts: ["saved", "save", "saving"], a: "save" }] },
            { title: "Set 3: Must", qs: [{ q: "You must ______ rules.", opts: ["follow", "follows", "following"], a: "follow" }, { q: "He must ______ home now.", opts: ["go", "to go", "going"], a: "go" }, { q: "We must ______ hard.", opts: ["work", "working", "worked"], a: "work" }, { q: "You must ______ careful.", opts: ["be", "is", "are"], a: "be" }, { q: "Drivers must ______.", opts: ["stopped", "stop", "stopping"], a: "stop" }] },
            { title: "Set 4: Why don't you", qs: [{ q: "Why don't you ______ a doctor?", opts: ["see", "seeing", "saw"], a: "see" }, { q: "Why don't you ______ a break?", opts: ["take", "taking", "takes"], a: "take" }, { q: "Why don't you ______ her?", opts: ["call", "calling", "calls"], a: "call" }, { q: "Why don't you ______ sorry?", opts: ["say", "said", "saying"], a: "say" }, { q: "Why don't you ______ it?", opts: ["try", "trying", "tries"], a: "try" }] },
            { title: "Set 5: Challenge", qs: [{ q: "You really should ______.", opts: ["relax", "relaxing", "to relax"], a: "relax" }, { q: "You must not ______ up.", opts: ["give", "giving", "gave"], a: "give" }, { q: "Why don't you ______?", opts: ["exercised", "exercise", "exercising"], a: "exercise" }, { q: "You could ______ a hobby.", opts: ["start", "starting", "starts"], a: "start" }, { q: "He should ______ less.", opts: ["worry", "worries", "worried"], a: "worry" }] }
        ];
        let gIndex = 0;

        function renderGrammarSet() {
            let set = grammarSets[gIndex];
            let html = ``;
            set.qs.forEach((item, idx) => {
                html += `
                <div class="quiz-item" id="q-box-${idx}">
                    <div class="quiz-question">${idx + 1}. ${item.q.replace('______', '__________')}</div>
                    <div class="quiz-options">
                        ${item.opts.map(opt => `<button class="option-btn" onclick="selectGrammar(this,${idx},'${opt}')">${opt}</button>`).join('')}
                    </div>
                    <input type="hidden" id="g-ans-${idx}" value="">
                </div>`;
            });
            document.getElementById('grammar-container').innerHTML = html;
            document.getElementById('g-level').innerText = gIndex + 1;
            document.getElementById('g-progress').style.width = `${(gIndex / 4) * 100}%`;
            document.getElementById('g-score').innerText = `Progress: ${gIndex * 20}%`;

            document.getElementById('g-prev-btn').disabled = (gIndex === 0);
            document.getElementById('g-next-btn').style.display = 'none';
            document.getElementById('g-check-btn').style.display = 'inline-block';
            document.getElementById('g-feedback').innerHTML = "";
        }

        function selectGrammar(btn, idx, val) {
            let p = btn.parentElement;
            p.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById(`g-ans-${idx}`).value = val;
        }

        function checkGrammar() {
            let set = grammarSets[gIndex], c = 0;
            set.qs.forEach((item, idx) => {
                let u = document.getElementById(`g-ans-${idx}`).value;
                let box = document.getElementById(`q-box-${idx}`);
                box.classList.remove('correct', 'wrong');
                if (u === item.a) {
                    c++;
                    box.classList.add('correct');
                } else {
                    box.classList.add('wrong');
                }
            });

            let fb = document.getElementById('g-feedback');
            if (c === 5) {
                fb.innerHTML = "<span style='color:#34d399'>üéâ Perfect! Level Complete.</span>";
                document.getElementById('g-check-btn').style.display = 'none';
                if (gIndex < 4) {
                    document.getElementById('g-next-btn').style.display = 'inline-block';
                } else {
                    fb.innerHTML = "<span style='color:#34d399'>üéâ All Grammer Levels Mastered!</span>";
                }
            } else {
                fb.innerHTML = "<span style='color:#f87171'>‚ö†Ô∏è Keep trying! Check the red boxes.</span>";
            }
        }
        function changeGrammarSet(d) { gIndex += d; renderGrammarSet(); }

        // --- PART 2: TONE ---
        const toneSets = [
            { title: "Level 1: Chinese Logic", qs: [{ bad: "Êàë‰∏çÂñúÊ¨¢„ÄÇ", opts: ["Ëøô‰∏™‰∏çÂ§™ÈÄÇÂêàÊàë (I don't think it suits me)", "ÂæàÈöæÁúã (It's ugly)"], a: "Ëøô‰∏™‰∏çÂ§™ÈÄÇÂêàÊàë (I don't think it suits me)" }, { bad: "‰Ω†‰∏ÄÂÆöË¶ÅÂÅö„ÄÇ", opts: ["‰Ω†Ë¶ÅÂÅö (Do it)", "ÊàëËßâÂæó‰Ω†ÂèØ‰ª•ËØïÁúã (I think you could try)"], a: "ÊàëËßâÂæó‰Ω†ÂèØ‰ª•ËØïÁúã (I think you could try)" }, { bad: "‰Ω†ÂæàÊáíÊÉ∞„ÄÇ", opts: ["‰Ω†ÊúÄËøëÂ•ΩÂÉèÂæàÁ¥Ø (You seem tired)", "‰Ω†Ê≤°Áî® (Useless)"], a: "‰Ω†ÊúÄËøëÂ•ΩÂÉèÂæàÁ¥Ø (You seem tired)" }] },
            { title: "Level 2: Health Advice", qs: [{ bad: "Stop eating junk food!", opts: ["You are fat.", "Why don't you try eating more fruits? (‰∏çÂ¶ÇËØïÁùÄÂ§öÂêÉÊ∞¥Êûú?)"], a: "Why don't you try eating more fruits? (‰∏çÂ¶ÇËØïÁùÄÂ§öÂêÉÊ∞¥Êûú?)" }, { bad: "Go exercise now!", opts: ["I think you should go for a walk. (ÊàëËßâÂæó‰Ω†Â∫îËØ•ÂéªÊï£Ê≠•)", "Run now!"], a: "I think you should go for a walk. (ÊàëËßâÂæó‰Ω†Â∫îËØ•ÂéªÊï£Ê≠•)" }, { bad: "You look terrible.", opts: ["You look a bit tired. (‰Ω†ÁúãËµ∑Êù•ÊúâÁÇπÁ¥Ø)", "You are ugly."], a: "You look a bit tired. (‰Ω†ÁúãËµ∑Êù•ÊúâÁÇπÁ¥Ø)" }] },
            { title: "Level 3: Social & Politeness", qs: [{ bad: "Go away!", opts: ["Get lost!", "I need some space right now. (ÊàëÁé∞Âú®ÈúÄË¶Å‰∏ÄÁÇπÁ©∫Èó¥)"], a: "I need some space right now. (ÊàëÁé∞Âú®ÈúÄË¶Å‰∏ÄÁÇπÁ©∫Èó¥)" }, { bad: "Your idea is stupid.", opts: ["I have a different idea. (ÊàëÊúâ‰∏ç‰∏ÄÊ†∑ÁöÑÊÉ≥Ê≥ï)", "That is dumb."], a: "I have a different idea. (ÊàëÊúâ‰∏ç‰∏ÄÊ†∑ÁöÑÊÉ≥Ê≥ï)" }, { bad: "Buy me this.", opts: ["I would really appreciate if you could buy this. (Â¶ÇÊûú‰Ω†ËÉΩ‰π∞Ëøô‰∏™Êàë‰ºöÂæàÊÑüÊøÄ)", "Give me money."], a: "I would really appreciate if you could buy this. (Â¶ÇÊûú‰Ω†ËÉΩ‰π∞Ëøô‰∏™Êàë‰ºöÂæàÊÑüÊøÄ)" }] }
        ];
        let tIndex = 0;

        function renderToneSet() {
            let set = toneSets[tIndex];
            let html = ``;
            set.qs.forEach((item, idx) => {
                html += `
                <div class="tone-card" id="tone-card-${idx}">
                    <div class="rude-box">"${item.bad}"</div>
                    <div style="font-size:1.5rem; color:#64748b">&rarr;</div>
                    <select class="polite-select" id="t-ans-${idx}">
                        <option value="">Make it polite...</option>
                        ${item.opts.sort(() => Math.random() - 0.5).map(o => `<option value="${o}">${o}</option>`).join('')}
                    </select>
                </div>`;
            });
            document.getElementById('tone-container').innerHTML = html;
            document.getElementById('t-level').innerText = tIndex + 1;
            document.getElementById('t-prev-btn').disabled = (tIndex === 0);

            document.getElementById('t-check-btn').style.display = 'inline-block';
            document.getElementById('t-next-btn').style.display = 'none';
            document.getElementById('t-feedback').innerText = "";
        }
        function changeToneSet(d) { tIndex += d; renderToneSet(); }

        function checkTone() {
            let set = toneSets[tIndex], c = 0;
            set.qs.forEach((item, idx) => {
                let sel = document.getElementById(`t-ans-${idx}`);
                let card = document.getElementById(`tone-card-${idx}`);
                if (sel.value === item.a) {
                    c++;
                    card.style.borderColor = "#34d399";
                    card.style.background = "rgba(16, 185, 129, 0.05)";
                } else {
                    card.style.borderColor = "#f87171";
                    card.style.background = "rgba(248, 113, 113, 0.05)";
                }
            });

            let fb = document.getElementById('t-feedback');
            if (c === 3) {
                fb.innerHTML = "<span style='color:#34d399'>‚ù§Ô∏è Much better! Empathy gained.</span>";
                document.getElementById('t-check-btn').style.display = 'none';
                if (tIndex < 2) document.getElementById('t-next-btn').style.display = 'inline-block';
            } else {
                fb.innerHTML = "<span style='color:#f87171'>‚ö†Ô∏è Still too rude. Try again.</span>";
            }
        }

        // --- PART 3: PUZZLE ---
        const puzzleSets = [{ title: "Scenario 1: Exam Stress", items: [{ label: "1. Greeting", opts: [{ t: "Hi Sarah,", c: "(Âó® Sarah)" }, { t: "Dear Sir,", c: "(Â∞äÊï¨ÁöÑÂÖàÁîü)" }], a: "Hi Sarah," }, { label: "2. Sympathy", opts: [{ t: "I am sorry to hear you are stressed.", c: "(Âê¨ËØ¥‰Ω†ÂéãÂäõÂ§ßÊàëÂæàÈöæËøá)" }, { t: "Stop crying.", c: "(Âà´Âì≠‰∫Ü)" }], a: "I am sorry to hear you are stressed." }, { label: "3. Advice 1", opts: [{ t: "Why don't you make a timetable?", c: "(‰∏çÂ¶ÇÂÅö‰∏™Êó∂Èó¥Ë°®?)" }, { t: "You must give up.", c: "(‰Ω†ÂøÖÈ°ªÊîæÂºÉ)" }], a: "Why don't you make a timetable?" }, { label: "4. Advice 2", opts: [{ t: "Also, you could listen to music.", c: "(ËÄå‰∏îÔºå‰Ω†ÂèØ‰ª•Âê¨Âê¨Ê≠å)" }, { t: "You are lazy.", c: "(‰Ω†ÂæàÊáí)" }], a: "Also, you could listen to music." }, { label: "5. Closing", opts: [{ t: "Good luck!", c: "(Á•ùÂ•ΩËøê)" }, { t: "See you never.", c: "(ÂÜç‰πü‰∏çËßÅ)" }], a: "Good luck!" }] }, { title: "Scenario 2: Fight with Friend", items: [{ label: "1. Greeting", opts: [{ t: "Hello John,", c: "(‰Ω†Â•Ω John)" }, { t: "To whom it may concern,", c: "(Ëá¥ÊúâÂÖ≥‰∫∫Â£´)" }], a: "Hello John," }, { label: "2. Sympathy", opts: [{ t: "I know you are sad about the fight.", c: "(ÊàëÁü•ÈÅì‰Ω†Âõ†‰∏∫ÂêµÊû∂ÂæàÈöæËøá)" }, { t: "You are wrong.", c: "(‰Ω†Èîô‰∫Ü)" }], a: "I know you are sad about the fight." }, { label: "3. Advice 1", opts: [{ t: "I think you should apologize.", c: "(ÊàëËßâÂæó‰Ω†Â∫îËØ•ÈÅìÊ≠â)" }, { t: "You must fight him again.", c: "(‰Ω†ÂøÖÈ°ªÂÜçÊâì‰ªñ)" }], a: "I think you should apologize." }, { label: "4. Advice 2", opts: [{ t: "Why don't you buy him a drink?", c: "(‰∏çÂ¶ÇËØ∑‰ªñÂñùÈ•ÆÊñô?)" }, { t: "Ignore him.", c: "(Âà´ÁêÜ‰ªñ)" }], a: "Why don't you buy him a drink?" }, { label: "5. Closing", opts: [{ t: "Hope you make up soon.", c: "(Â∏åÊúõ‰Ω†‰ª¨Âø´ÁÇπÂíåÂ•Ω)" }, { t: "Bad luck.", c: "(ÂÄíÈúâ)" }], a: "Hope you make up soon." }] }, { title: "Scenario 3: Lost Library Book", items: [{ label: "1. Greeting", opts: [{ t: "Hi Ali,", c: "(Âó® Ali)" }, { t: "Hey you,", c: "(ÂñÇ‰Ω†)" }], a: "Hi Ali," }, { label: "2. Sympathy", opts: [{ t: "Don't worry too much.", c: "(Âà´Â§™ÊãÖÂøÉ)" }, { t: "You are in big trouble.", c: "(‰Ω†È∫ªÁÉ¶Â§ß‰∫Ü)" }], a: "Don't worry too much." }, { label: "3. Advice 1", opts: [{ t: "You should tell the librarian.", c: "(‰Ω†Â∫îËØ•ÂëäËØâÂõæ‰π¶ÁÆ°ÁêÜÂëò)" }, { t: "Run away.", c: "(ÈÄÉË∑ë)" }], a: "You should tell the librarian." }, { label: "4. Advice 2", opts: [{ t: "You could offer to pay for it.", c: "(‰Ω†ÂèØ‰ª•ÊèêÂá∫ËµîÂÅø)" }, { t: "Steal another book.", c: "(ÂÅ∑Âè¶‰∏ÄÊú¨‰π¶)" }], a: "You could offer to pay for it." }, { label: "5. Closing", opts: [{ t: "Let me know how it goes.", c: "(ÂëäËØâÊàëÁªìÊûúÊÄéÊ†∑)" }, { t: "Whatever.", c: "(Èöè‰æøÂï¶)" }], a: "Let me know how it goes." }] }];
        let pIndex = 0;
        let showHints = false;

        function renderPuzzle() {
            let set = puzzleSets[pIndex];
            document.getElementById('puzzle-title').innerText = set.title;
            let html = ``;
            set.items.forEach((item, idx) => {
                html += `
                <div class="puzzle-row">
                    <div class="row-label">${item.label}</div>
                    <select class="puzzle-select" id="puz-${idx}">
                        <option value="">Select...</option>
                        ${item.opts.sort(() => Math.random() - 0.5).map(o => `<option value="${o.t}" data-cn="${o.c}">${o.t} ${showHints ? o.c : ''}</option>`).join('')}
                    </select>
                </div>`;
            });
            document.getElementById('puzzle-wrapper').innerHTML = html;
            document.getElementById('p-prev-btn').disabled = (pIndex === 0);
            document.getElementById('p-check-btn').style.display = 'inline-block';
            document.getElementById('p-next-btn').style.display = 'none';
            document.getElementById('p-feedback').innerText = "";
        }
        function changePuzzleSet(d) { pIndex += d; renderPuzzle(); }
        function toggleHints() { showHints = !showHints; renderPuzzle(); }

        function checkPuzzle() {
            let set = puzzleSets[pIndex], c = 0;
            set.items.forEach((item, idx) => {
                let sel = document.getElementById(`puz-${idx}`);
                if (sel.value === item.a) {
                    c++;
                    sel.style.borderColor = "#10b981";
                    sel.style.background = "#f0fdf4";
                    sel.style.color = "#15803d";
                } else {
                    sel.style.borderColor = "#f87171";
                    sel.style.background = "#fef2f2";
                    sel.style.color = "#b91c1c";
                }
            });

            let fb = document.getElementById('p-feedback');
            if (c === 5) {
                fb.innerHTML = "<span style='color:#34d399'>üìß LOGIC 100%! Sending Email...</span>";
                document.getElementById('p-check-btn').style.display = 'none';
                if (pIndex < 2) document.getElementById('p-next-btn').style.display = 'inline-block';
            } else {
                fb.innerHTML = "<span style='color:#f87171'>‚ùå Some parts are out of order.</span>";
            }
        }

        // --- PART 4: GENERATOR ---
        const probs = [
            { title: "No Money", h1: "save RM5 every day / stop buying bubble tea", h2: "do some chores to earn pocket money" },
            { title: "Sleepy", h1: "sleep earlier at night / stop playing games late", h2: "set an alarm clock" },
            { title: "Bullying", h1: "tell a teacher or your parents immediately", h2: "walk with your friends together" },
            { title: "Game Addict", h1: "limit your screen time to 1 hour", h2: "find a new hobby like sports" }
        ];
        let selProb = -1;

        function selectProblem(idx, el) {
            selProb = idx;
            document.querySelectorAll('.problem-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');

            document.getElementById('scaffold').style.display = 'block';
            document.getElementById('final-letter').style.display = 'none';

            document.getElementById('hint-1').innerText = probs[idx].h1;
            document.getElementById('hint-2').innerText = probs[idx].h2;

            // Scroll to form
            setTimeout(() => document.getElementById('scaffold').scrollIntoView({ behavior: "smooth" }), 100);
        }

        function generateLetter() {
            if (selProb === -1) return;
            let sym = document.getElementById('inp-sympathy').value;
            let a1 = document.getElementById('inp-adv1').value || "[First Advice]";
            let a2 = document.getElementById('inp-adv2').value || "[Second Advice]";
            let cl = document.getElementById('inp-close').value;

            let letter = `Hi Friend,\n\n${sym} I know it is difficult for you.\n\nHere is my advice. First, ${a1}. This will help you solve the problem.\n\nAlso, ${a2}. It is a good idea.\n\n${cl}\n\nYour friend,\n[Your Name]`;

            let out = document.getElementById('final-letter');
            out.innerText = letter;
            out.style.display = 'block';
            out.scrollIntoView({ behavior: "smooth" });
        }

        // Init
        renderGrammarSet();
        renderToneSet();
        renderPuzzle();

    </script>
</body>

</html>