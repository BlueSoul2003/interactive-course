<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UEC Grammar (Paper 2) | English Mastery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Academic/Exam Theme - Consistent with Reading Module */
            --bg-color: #0f172a;
            --surface-color: #1e293b;
            --paper-color: #f1f5f9;
            --paper-text: #1e293b;

            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);

            --accent-gold: #d97706;
            --accent-gold-glow: rgba(217, 119, 6, 0.3);

            --correct-color: #10b981;
            --wrong-color: #ef4444;

            --font-serif: 'Merriweather', serif;
            --font-sans: 'Inter', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid var(--accent-gold);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-family: var(--font-serif);
            font-size: 1.4rem;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .logo span {
            color: var(--accent-gold);
        }

        /* --- Layout --- */
        main {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
            flex-grow: 1;
        }

        .section-title {
            text-align: center;
            font-family: var(--font-serif);
            margin-bottom: 10px;
            font-size: 2.2rem;
            color: var(--text-primary);
        }

        .section-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
        }

        .tab-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 10px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .tab-btn.active {
            background: var(--accent-gold);
            color: white;
            border-color: var(--accent-gold);
        }

        /* --- Tips Sidebar Layout --- */
        .content-split {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            align-items: start;
        }

        /* Toggle & CN Text */
        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent-gold);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .cn-text {
            display: none;
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: normal;
        }

        body.show-cn .cn-text {
            display: block;
        }

        body.show-cn .tip-item strong .cn-inline {
            display: inline;
        }

        .cn-inline {
            display: none;
            margin-left: 5px;
            color: #cbd5e1;
        }


        .tips-card {
            background: var(--surface-color);
            border: 1px solid var(--accent-gold);
            border-radius: 8px;
            padding: 25px;
            position: sticky;
            top: 100px;
        }

        .tips-card h3 {
            color: var(--accent-gold);
            font-family: var(--font-serif);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-item {
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .tip-item strong {
            color: #feebc8;
            display: block;
            margin-bottom: 3px;
        }

        /* --- Questions --- */
        .exam-panel {
            display: none;
        }

        .exam-panel.active {
            display: block;
            animation: activePanel 0.4s ease-out;
        }

        @keyframes activePanel {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-box {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Error ID Styles */
        .sentence-display {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 4px;
        }

        .error-opt {
            border-bottom: 2px solid var(--accent-gold);
            color: var(--text-primary);
            cursor: pointer;
            padding: 0 2px;
            transition: 0.2s;
        }

        .error-opt:hover {
            background: rgba(217, 119, 6, 0.2);
        }

        .error-opt.selected {
            background: var(--accent-gold);
            color: white;
        }

        .error-opt.correct {
            background: var(--correct-color);
            color: white;
            border-color: transparent;
        }

        .error-opt.wrong {
            background: var(--wrong-color);
            color: white;
            border-color: transparent;
        }

        .feedback-box {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            /* slightly lighter than bg */
            border-radius: 4px;
            border-left: 3px solid var(--accent-gold);
            display: none;
            font-size: 0.95rem;
        }

        /* Word Form Styles */
        .word-form-input {
            background: var(--bg-color);
            border: 1px solid var(--text-secondary);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 0 5px;
            font-family: monospace;
            font-size: 1rem;
            width: 150px;
        }

        .word-form-input:focus {
            border-color: var(--accent-gold);
            outline: none;
        }

        .word-form-input.correct {
            border-color: var(--correct-color);
            color: var(--correct-color);
        }

        .word-form-input.wrong {
            border-color: var(--wrong-color);
            color: var(--wrong-color);
        }

        .check-btn {
            background: var(--accent-gold);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .check-btn:hover {
            background: #b45309;
        }

        @media (max-width: 900px) {
            .content-split {
                grid-template-columns: 1fr;
            }

            .tips-card {
                position: static;
                margin-bottom: 30px;
            }
        }
    </style>
</head>

<body class="show-cn">

    <header>
        <a href="index.html" class="logo">
            <span>🎓</span> UEC English (2017)
        </a>
        <div class="header-controls" style="display:flex; gap:20px; align-items:center;">
            <div class="toggle-wrapper">
                <span>Show Chinese</span>
                <label class="switch">
                    <input type="checkbox" id="cn-toggle" checked onchange="document.body.classList.toggle('show-cn')">
                    <span class="slider"></span>
                </label>
            </div>
            <a href="index.html" style="color:var(--text-secondary); text-decoration:none; font-size:0.9rem;">Exit</a>
        </div>
    </header>

    <main>
        <div class="section-title">Senior English Paper 2</div>
        <p class="section-subtitle">Section B: Language Use (20%)</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="showPanel(0)">Part I: Error Identification</button>
            <button class="tab-btn" onclick="showPanel(1)">Part II: Word Forms</button>
        </div>

        <!-- PART I -->
        <div id="panel-0" class="exam-panel active">
            <div class="content-split">
                <!-- Sidebar Tips -->
                <div class="tips-card">
                    <h3>💡 Exam Tips <span class="cn-text"
                            style="display:none; display:inline-block; margin-left:10px;">(做题技巧)</span></h3>
                    <div class="tip-item">
                        <strong>1. Verbs (动词) <span class="cn-inline">找动词</span></strong>
                        Check Tense (ed/ing), Modals (can+root), SVA (he goes).
                        <div class="cn-text">看到划线的是动词，检查：时态 (Tense)，搭配 (Modal Verbs)，单复数 (SVA/Agreement)。</div>
                    </div>
                    <div class="tip-item">
                        <strong>2. Nouns/Adj (名词/形容词) <span class="cn-inline">找形容词</span></strong>
                        Countable? "Two-hour flight" (no s).
                        <div class="cn-text">复合形容词：数字+名词，名词不能加s (e.g. A two-hour flight)。</div>
                    </div>
                    <div class="tip-item">
                        <strong>3. Confusing Words (易混词)</strong>
                        Past vs Pass. Access vs Excess.
                        <div class="cn-text">注意易混词：Past (经过/过去) vs Pass (通过 - 动词); Access (进入) vs Excess (过度)。</div>
                    </div>
                </div>

                <!-- Content -->
                <div id="error-container">
                    <!-- Q26 -->
                    <div class="question-box">
                        <div style="margin-bottom:10px;color:var(--text-secondary);">Q26. Click the ERROR.</div>
                        <div class="sentence-display" id="q26-sent">
                            Peter has an anti-social personality because he <span class="error-opt"
                                onclick="selErr(26, 'A')">will never taken</span> (A) part in any activities or
                            functions <span class="error-opt" onclick="selErr(26, 'B')">in</span> (B) school.
                        </div>
                        <div id="fb-26" class="feedback-box"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PART II -->
        <div id="panel-1" class="exam-panel">
            <div class="content-split">
                <!-- Sidebar Tips -->
                <div class="tips-card">
                    <h3>💡 Word Form Tips <span class="cn-text"
                            style="display:none; display:inline-block; margin-left:10px;">(变形技巧)</span></h3>
                    <div class="tip-item">
                        <strong>Noun (名词) <span class="cn-inline">看前后词</span></strong>
                        After: a/an/the, of, in. Suffix: -tion, -ment, -ness.
                        <div class="cn-text">The/A/An + ___ + of/in/on -> 填名词。后缀: -tion, -ment, -ness, -ity。</div>
                    </div>
                    <div class="tip-item">
                        <strong>Adjective (形容词)</strong>
                        After: is/are/was. Suffix: -al, -ive, -ous, -able.
                        <div class="cn-text">Is/Are/Was + ___ -> 填形容词。后缀: -al, -ive, -ous, -able, -ful。</div>
                    </div>
                    <div class="tip-item">
                        <strong>Adverb (副词)</strong>
                        Modifies verb. Ends in -ly.
                        <div class="cn-text">动词 + ___ -> 填副词 (-ly)。To + ___ -> 填动词原形。</div>
                    </div>
                </div>

                <div class="question-box">
                    <div class="sentence-display">
                        <p>
                            Before the invention of books, people wrote on stone and clay... But to make a book, a real
                            book as we know today, you need paper and printing.
                            <span class="cn-text">在书籍发明之前，人们在石头和粘土上书写... 但要制作一本书，一本我们今天所知道的真正的书，你需要纸和印刷术。</span>
                        </p>

                        <p>
                            Paper was perhaps the greatest tool for <span style="font-weight:bold">(36)</span> <input
                                type="text" class="word-form-input" id="wf-36" placeholder="communicate"> until the
                            computer was invented. The best evidence indicates that paper was invented by the Chinese
                            between the years 250 B.C. and 105 B.C. <span style="font-weight:bold">(37)</span> <input
                                type="text" class="word-form-input" id="wf-37" placeholder="History"> studying Asian
                            culture have found more <span style="font-weight:bold">(38)</span> <input type="text"
                                class="word-form-input" id="wf-38" placeholder="convince"> proof that paper was soon
                            used to print money.
                        <div class="cn-text">直到计算机发明之前，纸张或许是 (36) 交流 最伟大的工具。最好的证据表明，纸张是中国人在公元前250年到公元前105年之间发明的。(37)
                            历史学家 研究亚洲文化发现了更多 (38) 令人信服的 证据，证明纸张很快就被用来印制货币。</div>
                        </p>

                        <p>
                            Paper money is one of the most <span style="font-weight:bold">(39)</span> <input type="text"
                                class="word-form-input" id="wf-39" placeholder="use"> inventions in history, and it
                            greatly helped the <span style="font-weight:bold">(40)</span> <input type="text"
                                class="word-form-input" id="wf-40" placeholder="develop"> of trade and commerce in
                            China. People make a big mistake when they think that printing is <span
                                style="font-weight:bold">(41)</span> <input type="text" class="word-form-input"
                                id="wf-41" placeholder="entire"> a Western discovery.
                        <div class="cn-text">纸币是历史上最 (39) 有用的 发明之一，它极大地帮助了中国贸易和商业的 (40) 发展。当人们认为印刷术 (41) 完全
                            是西方的发现时，他们犯了一个大错误。</div>
                        </p>

                        <p>
                            In fact, the first ideas about printing also came to us from China... It is said that in
                            11th century China, a blacksmith named Pi Sheng invented the best system for <span
                                style="font-weight:bold">(42)</span> <input type="text" class="word-form-input"
                                id="wf-42" placeholder="print"> with blocks.
                        <div class="cn-text">事实上，关于印刷术最初的想法也来自中国... 据说在11世纪的中国，一位名叫毕升的铁匠发明了最好的活字 (42) 印刷 系统。</div>
                        </p>

                        <p>
                            Did this discovery travel to the West? Did a <span style="font-weight:bold">(43)</span>
                            <input type="text" class="word-form-input" id="wf-43" placeholder="Europe"> make the
                            discovery again by himself? Nobody is sure of the answer. But we do know that Johannes
                            Gutenberg... created the first printing press with <span
                                style="font-weight:bold">(44)</span> <input type="text" class="word-form-input"
                                id="wf-44" placeholder="move"> type in Europe around the year 1450.
                        <div class="cn-text">这项发现传到西方了吗？是一位 (43) 欧洲人 自己再次发现了它吗？没有人确切知道答案。但我们要知道，Johannes Gutenberg...
                            大约在1450年在欧洲发明了第一台使用 (44) 可移动 铅字的印刷机。</div>
                        </p>

                        <p>
                            Without these contributions to paper and printing, it would not have been possible to invent
                            the book, one of the highest <span style="font-weight:bold">(45)</span> <input type="text"
                                class="word-form-input" id="wf-45" placeholder="achieve"> of the last millennium.
                        <div class="cn-text">如果没有这些对纸张和印刷术的贡献，就不可能发明书，这是上一个千年最高的 (45) 成就 之一。</div>
                        </p>
                    </div>
                    <button class="check-btn" onclick="checkWordForms()">Check Answers</button>
                    <div id="wf-feedback" style="margin-top:20px; font-weight:bold; color:var(--text-primary);"></div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DATA PART I ---
        const errorQs = [
            {
                id: 26,
                html: `Peter has an anti-social personality because he <span class="error-opt" id="opt-26-A" onclick="selErr(26, 'A')">will never taken</span> (A) part in any <span class="error-opt" id="opt-26-C" onclick="selErr(26, 'C')">activities</span> (C) or <span class="error-opt" id="opt-26-D" onclick="selErr(26, 'D')">functions</span> (D) <span class="error-opt" id="opt-26-B" onclick="selErr(26, 'B')">in</span> (B) school.`,
                ans: 'A',
                expl: "Modal verb 'will' must be followed by base form 'take', not 'taken'.",
                explCn: "Modal verb (情态动词) will 后面必须跟原形动词 (Base Form)。不能用过去分词 taken。",
                trans: "Peter 具有反社会人格，因为他绝不会参加学校的任何活动或集会。"
            },
            {
                id: 27,
                html: `I did not see <span class="error-opt" id="opt-27-A" onclick="selErr(27, 'A')">anybody</span> (A) in the classroom <span class="error-opt" id="opt-27-B" onclick="selErr(27, 'B')">as</span> (B) <span class="error-opt" id="opt-27-C" onclick="selErr(27, 'C')">they were</span> (C) many events being held <span class="error-opt" id="opt-27-D" onclick="selErr(27, 'D')">at</span> (D) the school hall.`,
                ans: 'C',
                expl: "Should be 'there were' (existential) not 'they were'.",
                explCn: "这里是想说“有许多活动”。英文的“有”在句首通常用 There be 句型。They were 意思是“它们是”。",
                trans: "我在教室里没看到任何人，因为在学校大厅里举行着许多活动。"
            },
            {
                id: 28,
                html: `The bus <span class="error-opt" id="opt-28-A" onclick="selErr(28, 'A')">carried</span> (A) twenty passengers <span class="error-opt" id="opt-28-B" onclick="selErr(28, 'B')">lost</span> (B) control and <span class="error-opt" id="opt-28-C" onclick="selErr(28, 'C')">crashed</span> (C) into a lamp post before <span class="error-opt" id="opt-28-D" onclick="selErr(28, 'D')">plunging</span> (D) into a ravine.`,
                ans: 'A',
                expl: "Main verb is 'lost'. Bus should be modified by 'carrying' (participle) not 'carried'.",
                explCn: "一个句子里不能有两个谓语动词（carried 和 lost）打架。这里 carried 修饰 bus，应该用分词形式 carrying (载着) 或定语从句。",
                trans: "那辆载着20名乘客的巴士失控撞上了灯柱，然后坠入山沟。"
            },
            {
                id: 29,
                html: `It was a <span class="error-opt" id="opt-29-A" onclick="selErr(29, 'A')">pleasant</span> (A) <span class="error-opt" id="opt-29-B" onclick="selErr(29, 'B')">two-hours</span> (B) flight to Singapore but when we <span class="error-opt" id="opt-29-C" onclick="selErr(29, 'C')">arrived</span> (C), my grandma complained of <span class="error-opt" id="opt-29-D" onclick="selErr(29, 'D')">tiredness</span> (D).`,
                ans: 'B',
                expl: "Compound adjectives like 'two-hour' do not use plural 's'.",
                explCn: "当“数字+名词”作为形容词修饰后面的词（flight）时，中间要加连字符，且名词不能加s。例如：A 5-year-old boy。",
                trans: "那是一趟去新加坡的愉快的两小时飞行，但当我们到达时，我奶奶抱怨说很累。"
            },
            {
                id: 30,
                html: `If he <span class="error-opt" id="opt-30-A" onclick="selErr(30, 'A')">has had</span> (A) enough money at that time, he <span class="error-opt" id="opt-30-B" onclick="selErr(30, 'B')">would have bought</span> (B) a large mansion <span class="error-opt" id="opt-30-C" onclick="selErr(30, 'C')">with</span> (C) an indoor swimming pool <span class="error-opt" id="opt-30-D" onclick="selErr(30, 'D')">for</span> (D) his family.`,
                ans: 'A',
                expl: "Type 3 Conditional requires Past Perfect: 'had had', not 'has had'.",
                explCn: "这是 Type 3 Conditional (虚拟语气)。后面是 'would have bought'，前面 IF 从句必须用 Past Perfect (过去完成时)，即 'had + p.p.'。",
                trans: "如果那时他有足够的钱，他就会为他的家人买一栋带有室内游泳池的大豪宅。"
            },
            {
                id: 31,
                html: `Her legs <span class="error-opt" id="opt-31-A" onclick="selErr(31, 'A')">felt</span> (A) weak, and she sat heavily on the curb, <span class="error-opt" id="opt-31-B" onclick="selErr(31, 'B')">struggling</span> (B) to control her breathing so she <span class="error-opt" id="opt-31-C" onclick="selErr(31, 'C')">didn't</span> (C) <span class="error-opt" id="opt-31-D" onclick="selErr(31, 'D')">past out</span> (D).`,
                ans: 'D',
                expl: "'Past' is noun/adj. Verb is 'pass' out.",
                explCn: "Did/Didn't 后面跟原形动词。Pass 是动词（昏倒），Past 是名词或介词（过去）。",
                trans: "她的腿感到虚弱，重重地坐在路边，挣扎着控制呼吸，以免昏倒。"
            },
            {
                id: 32,
                html: `All over the world, people are <span class="error-opt" id="opt-32-A" onclick="selErr(32, 'A')">gaining</span> (A) <span class="error-opt" id="opt-32-B" onclick="selErr(32, 'B')">excess</span> (B) to the Internet and <span class="error-opt" id="opt-32-C" onclick="selErr(32, 'C')">using</span> (C) the computers <span class="error-opt" id="opt-32-D" onclick="selErr(32, 'D')">to go</span> (D) online.`,
                ans: 'B',
                expl: "Wrong word. 'Access' (entry), not 'Excess' (too much).",
                explCn: "词汇混淆。Access (n.) 通道/使用权；Excess (n.) 过量/过度。这里指“连接互联网的权限”。",
                trans: "在世界各地，人们正在获得互联网的访问权，并使用电脑上网。"
            },
            {
                id: 33,
                html: `Mrs. Chow <span class="error-opt" id="opt-33-A" onclick="selErr(33, 'A')">complemented</span> (A) Lynette on her punctuality in <span class="error-opt" id="opt-33-B" onclick="selErr(33, 'B')">completing</span> (B) her homework while <span class="error-opt" id="opt-33-C" onclick="selErr(33, 'C')">reprimanding</span> (C) Lucy on her <span class="error-opt" id="opt-33-D" onclick="selErr(33, 'D')">tardiness</span> (D).`,
                ans: 'A',
                expl: "Wrong word. 'Complimented' (praised), not 'Complemented' (matched).",
                explCn: "词汇混淆。Compliment (v.) 赞美/夸奖；Complement (v.) 补充/相配。句意是老师夸奖她守时。",
                trans: "周太太称赞 Lynette 完成作业守时，同时斥责 Lucy 迟到。"
            },
            {
                id: 34,
                html: `James <span class="error-opt" id="opt-34-A" onclick="selErr(34, 'A')">returned</span> (A) presently with a carriage, got the broken-hearted artist and the <span class="error-opt" id="opt-34-B" onclick="selErr(34, 'B')">broken-leg</span> (B) statue <span class="error-opt" id="opt-34-C" onclick="selErr(34, 'C')">aboard</span> (C), and drove off, whistling softly and <span class="error-opt" id="opt-34-D" onclick="selErr(34, 'D')">tranquilly</span> (D).`,
                ans: 'B',
                expl: "Adjective requires -ed: 'broken-legged'.",
                explCn: "形容“断了腿的”，英文习惯用 Noun + -ed 构成形容词。例如：One-legged。所以应该是 broken-legged。",
                trans: "James 很快带着马车回来了，让心碎的艺术家和断腿的雕像上了车，然后驾车离开，轻声而平静地吹着口哨。"
            },
            {
                id: 35,
                html: `The novel, Transformers Dark Moon <span class="error-opt" id="opt-35-A" onclick="selErr(35, 'A')">tells what happens</span> (A) in a futuristic society when everyone <span class="error-opt" id="opt-35-B" onclick="selErr(35, 'B')">is lulled</span> (B) into <span class="error-opt" id="opt-35-C" onclick="selErr(35, 'C')">complacence</span> (C) in a futuristic world that <span class="error-opt" id="opt-35-D" onclick="selErr(35, 'D')">relies upon</span> (D) the programming of human beings.`,
                ans: 'C',
                expl: "'Complacency' is the standard noun form here.",
                explCn: "虽然 complacence 也是词，但 Complacency 是更标准的名词形式，表示“自满/安于现状”的状态。",
                trans: "小说《变形金刚：月黑之时》讲述了一个未来社会发生的事情，那时每个人都被哄骗进入自满状态，而这个未来世界依赖于人类的程序化。"
            }
        ];

        function renderErrors() {
            let html = ``;
            errorQs.forEach(q => {
                html += `
                <div class="question-box">
                    <div style="margin-bottom:10px;color:var(--text-secondary);">Q${q.id}. Click the ERROR.</div>
                    <div class="sentence-display" id="q${q.id}-sent">${q.html}</div>
                    <div class="cn-text" style="color:#94a3b8; font-style:italic; margin-top:5px; padding-left:10px; border-left:2px solid #334155;">${q.trans}</div>
                    <div id="fb-${q.id}" class="feedback-box"></div>
                </div>`;
            });
            document.getElementById('error-container').innerHTML = html;
        }

        function selErr(qid, choice) {
            let q = errorQs.find(x => x.id === qid);
            let fb = document.getElementById(`fb-${qid}`);
            // Remove previous selections
            document.querySelectorAll(`#q${qid}-sent .error-opt`).forEach(el => el.classList.remove('selected', 'correct', 'wrong'));

            // Highlight select
            let el = document.getElementById(`opt-${qid}-${choice}`);
            if (el) el.classList.add('selected');

            if (choice === q.ans) {
                fb.style.display = 'block';
                fb.innerHTML = `<span style="color:var(--correct-color)">✅ Correct!</span> ${q.expl} <div class="cn-text" style="color:#10b981; border-top:1px dashed #ffffff20; margin-top:5px; padding-top:5px;">解析: ${q.explCn}</div>`;
                if (el) el.classList.add('correct');
            } else {
                fb.style.display = 'block';
                fb.innerHTML = `<span style="color:var(--wrong-color)">❌ Try again.</span> check the grammar rules. <div class="cn-text">请检查语法规则。</div>`;
                if (el) el.classList.add('wrong');
            }
        }

        // --- PART II WORD FORMS ---
        const wfAns = {
            36: "communication",
            37: "Historians",
            38: "convincing",
            39: "useful",
            40: "development",
            41: "entirely",
            42: "printing",
            43: "European",
            44: "movable",
            45: "achievements"
        };

        // Distractors for 2-attempt fallback
        const wfDistractors = {
            36: "communicate", // vs communication
            37: "History",     // vs Historians
            38: "convinced",   // vs convincing
            39: "use",         // vs useful
            40: "develop",     // vs development
            41: "entire",      // vs entirely
            42: "print",       // vs printing
            43: "Europe",      // vs European
            44: "move",        // vs movable
            45: "achievement"  // vs achievements (plural)
        };

        let attemptCounts = {};
        // Initialize attempts
        for (let i = 36; i <= 45; i++) attemptCounts[i] = 0;

        function checkWordForms() {
            let correctCount = 0;
            let total = 10;

            for (let i = 36; i <= 45; i++) {
                let container = document.getElementById(`wf-container-${i}`) || document.getElementById(`wf-${i}`).parentElement; // fallback logic
                // Check if it's input or select
                let el = document.getElementById(`wf-${i}`);
                if (!el) continue; // Should not happen

                let val = el.value.trim();
                let isCorrect = val.toLowerCase() === wfAns[i].toLowerCase();

                if (isCorrect) {
                    el.classList.add('correct');
                    el.classList.remove('wrong');
                    correctCount++;
                    // Disable if correct
                    el.disabled = true;
                    if (el.tagName === 'SELECT') el.style.borderColor = 'var(--correct-color)';
                } else {
                    el.classList.add('wrong');
                    el.classList.remove('correct');

                    // Increment attempts if still an input
                    if (el.tagName === 'INPUT') {
                        attemptCounts[i]++;
                        if (attemptCounts[i] >= 2) {
                            switchToOptions(i);
                        }
                    }
                }
            }

            let fb = document.getElementById('wf-feedback');
            if (correctCount === total) {
                fb.innerHTML = "🎉 Perfect Score! You master morphology. <div class='cn-text' style='color:#10b981'>完美！你掌握了词形变化。</div>";
            } else {
                fb.innerHTML = `You got ${correctCount} / ${total} correct. Check the red boxes. <div class='cn-text' style='color:#ef4444'>你做对了 ${correctCount} / ${total} 题。检查红框部分。</div>`;
            }
        }

        function switchToOptions(id) {
            let input = document.getElementById(`wf-${id}`);
            if (!input) return;

            let correct = wfAns[id];
            let wrong = wfDistractors[id];

            // Randomize order
            let opts = Math.random() < 0.5 ? [correct, wrong] : [wrong, correct];

            // Create Select
            let select = document.createElement('select');
            select.id = `wf-${id}`;
            select.className = 'word-form-input';
            select.style.cursor = 'pointer';
            select.style.padding = '5px';

            let defaultOpt = document.createElement('option');
            defaultOpt.text = "Choose...";
            defaultOpt.value = "";
            select.add(defaultOpt);

            opts.forEach(opt => {
                let o = document.createElement('option');
                o.text = opt;
                o.value = opt;
                select.add(o);
            });

            input.replaceWith(select);
        }


        function showPanel(n) {
            document.querySelectorAll('.exam-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`panel-${n}`).classList.add('active');
            document.querySelectorAll('.tab-btn')[n].classList.add('active');
        }

        // Init
        renderErrors();

    </script>
</body>

    <script src="../../../../../js/progress-tracker.js"
            data-module-id="UEC_Grammar"
            data-module-name="UEC Senior English Grammar"
            data-module-url="content/UEC_Syllabus/Senior/English/Grammar/index.html"></script>
    <script>
        window.addEventListener('load', async () => {
            if (!window.ProgressTracker) return;
            const saved = await ProgressTracker.load();
            if (saved && saved.progress_data && saved.progress_data.part) {
                const pt = saved.progress_data.part;
                if (pt === 2 && typeof renderErrors === 'function') renderErrors();
            }
        });
        // Hook tab switching - Grammar uses buttons to call renderPart1/renderErrors
        const _origRenderPart1 = (typeof renderPart1 !== 'undefined') ? renderPart1 : null;
        const _origRenderErrors = (typeof renderErrors !== 'undefined') ? renderErrors : null;
        if (_origRenderPart1) {
            renderPart1 = function() { _origRenderPart1(); if (window.ProgressTracker) ProgressTracker.save({ part: 1 }); };
        }
        if (_origRenderErrors) {
            renderErrors = function() { _origRenderErrors(); if (window.ProgressTracker) ProgressTracker.save({ part: 2 }); };
        }
    </script>
</html>